FancypageApp.module("Dashboard.Models",function(a,b,c){"use strict";a.Page=c.Model.extend({idAttribute:"uuid",defaults:{uuid:null,name:null,url:null,status:null,isVisible:!1,children:[]},initialize:function(){this.set("children",new a.Pages(this.get("children")))},move:function(a){return this.save(a,{url:this.url()+"/move"})},url:function(){return b.Api.baseUrl+"/page/"+this.id}}),a.Pages=c.Collection.extend({model:a.Page,url:b.Api.baseUrl+"/pages"})}),FancypageApp.module("Dashboard.Views",function(a,b,c,d,e){"use strict";var f=b.Dashboard.Models;a.PageNode=d.CompositeView.extend({tagName:"li",itemViewContainer:"ol",template:"#template-page-node",events:{"show [id$=-tree]":"showChildren"},initialize:function(){this.collection=this.model.get("children"),this.events["hidden [id="+this.model.id+"-tree]"]="hideChildren"},hideChildren:function(a){var b=e(a.currentTarget).attr("id"),c=e("[data-target=#"+b+"]>i");return e(a.currentTarget).hasClass("in")?!1:(c.removeClass("fp-icon-square-minus"),void c.addClass("fp-icon-square-plus"))},showChildren:function(a){var b=e(a.currentTarget).attr("id"),c=e("[data-target=#"+b+"]>i");c.removeClass("fp-icon-square-plus"),c.addClass("fp-icon-square-minus")},onCompositeModelRendered:function(){this.$el.attr("data-index",this.model.collection.indexOf(this.model)),this.$el.attr("data-page-id",this.model.id),this.$el.children("ol").attr("id",this.model.id+"-tree")}}),a.PageTree=d.CollectionView.extend({el:"ol.fp-page-management",itemView:a.PageNode,events:{"show.bs.collapse .row-actions-position .collapse":"pageSelect","shown.bs.collapse .row-actions-position .collapse":"closeActions","click .fp-children-toggle":"toggleChildren"},initialize:function(){this.sortable=this.$el.sortable({onDrop:this.saveMovedPage,handle:".fp-pagemove"}),e(window).resize(function(){e(".fp-page-management").height(e(window).height()-220)}),e(window).trigger("resize")},saveMovedPage:function(a,c,d){d(a,c);var g=c.$getChildren(c.el,"item"),h=g.index(a),i=a.data("index"),j=new f.Page({uuid:a.data("page-id")}),k=j.move({parent:e(c.el).data("parent-id"),new_index:h,old_index:i});k.complete(b.Api.reloadPage)},toggleChildren:function(a){a.stopPropagation();var b=e(a.target).attr("data-target");e(b).collapse("toggle")},pageSelect:function(a){e(".row-actions-position .collapse").not(e(a.target)).each(function(){e(this).hasClass("in")&&e(this).parent().next().addClass("collapsed")})},closeActions:function(a){e(".row-actions-position .collapse").not(e(a.target)).each(function(){e(this).hasClass("in")&&e(this).collapse("hide")})}})});